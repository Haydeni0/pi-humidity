
# A sort of guide to how the raspberry pi is set up
I can't really remember, most of this was written after I fully set up everything. I'll write down what I think I did in the correct order, along with some links to the tutorials if possible.

### Useful tools on secondary computer
- Git
  - Sourcetree
- Filezilla
- VS Code
- PuTTY
  - Pageant, puttygen for ssh keys
- MySQL server replicate, SQL workbench

### Useful packages in raspi
- ```screen``` (Multiple consistent terminal screens)
- ```unattended-upgrades``` (automatic upgrades)

### Ordered guide for raspberry pi installation
1. Install raspberry pi OS
2. Add SSH capabilities (to login remotely)
   1. Use an [ssh key](https://pimylifeup.com/raspberry-pi-ssh-keys/) to log in automatically
   2. Configure that with PuTTY
3. ```sudo apt-get update``` and ```sudo apt-get upgrade```
4. Install python3 and packages, update the required ones to the latest versions
5. Install [git](https://projects.raspberrypi.org/en/projects/getting-started-with-git)
   1. Also use an ssh key, as my github account requires one
6. Install python and required modules
   1. Including the [DHT22](https://pimylifeup.com/raspberry-pi-humidity-sensor-dht22/) humidity sensor packages
7. [Install](https://pimylifeup.com/raspberry-pi-humidity-sensor-dht22/) the DHT22 humidity temp sensor 
8. Install [MySQL](https://pimylifeup.com/raspberry-pi-mysql/)
   1. Set options in the config file to allow [external connections](https://howtoraspberrypi.com/enable-mysql-remote-connection-raspberry-pi/) and database replication: 

            [mysqld]
            server-id=21 # Two servers can't have the same server id, default is 1
            log_bin = /var/log/mysql/mysql-bin.log # Enable binary logging for replication
            bind_address = 0.0.0.0 # Allow the server to check for external connections (using the default port 3306)
    1. Set up [replication](https://www.digitalocean.com/community/tutorials/how-to-set-up-replication-in-mysql) to a different pc
    2. Set up monthly mysqldump database backups to google drive using rclone (contained in ```dbBackup.sh``` and ```send_mysqldump.sh```, and put on a monthly cronjob)
9. Use a cronjob at reboot to start the data logging python script
   1. Optionally, get it to forward the output to a file just in case an error is raised
10. Use the [autostart](https://learn.sparkfun.com/tutorials/how-to-run-a-raspberry-pi-program-on-startup/method-2-autostart) folder ```/home/pi/.config/autostart``` with a ```dhtPlotting.desktop``` file to start the python script once the desktop has loaded.
11. Install package ```unclutter``` to get rid of idle mouse cursor, run on desktop load in the same manner as the python plotter
12. Install ```nginx``` for [hosting a website](https://pimylifeup.com/raspberry-pi-nginx/) from the pi. This is to be able to access snapshots of the DHT graph from the internet.
    - Change the default root directory of nginx in the config file ```/etc/nginx/sites-available/default``` to ```root /home/pi/pi-humidity/html;```
13. Use [dynu](https://www.dynu.com/en-US/ControlPanel/DDNS) to host the website domain name
   - Install the [dynamic update client](https://www.dynu.com/DynamicDNS/IPUpdateClient/DDClient) on the raspi

      Config file:

         # Configuration file for ddclient generated by debconf
         #
         # /etc/ddclient.conf
         daemon=600 
         # Does this daemon timing even work? [https://www.linuxquestions.org/questions/linux-server-73/ddclient-not-honoring-daemon-time-interval-4175616937/]. Doesn't really matter.
         protocol=dyndns2
         use=web, web=checkip.dyndns.org
         server=api.dynu.com
         login=haydeni0
         password='??????????'
         raspidht.webredirect.org
14. Install an SSL certificate for the server
  - Use [certbot](https://certbot.eff.org/lets-encrypt/otherpip-nginx), but maybe follow the rest of the tutorial from [pimylifeup](https://pimylifeup.com/raspberry-pi-ssl-lets-encrypt/) as this is the one that finally worked.
    - Make sure to use the command

            certbot certonly --webroot -w /home/pi/pi-humidity/html -d raspidht.webredirect.org
      to properly set up the certificate
    - And probably do the dhparam bit on a fast computer, other wise it will take years on the rpi
    - Make sure both port 80 and 443 are port forwarded, and that nginx is listening on 443
  - RENEWAL
    - Not working at the moment, same problem as in [this](https://github.com/certbot/certbot/issues/9144) thread...
15. [Secure](https://arstechnica.com/gadgets/2012/11/how-to-set-up-a-safe-and-secure-web-server/4/) the web server
  - Not sure this works easily, the location ```deny all``` bit caused it to not work (likely due to not knowing what is happening here)
16. Use android app "Widgetify" to display on phone home screen, now that SSL is working